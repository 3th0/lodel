<?php  include("tpl/install-openhtml.html"); ?>
<!--

  LODEL - Logiciel d'Edition ELectronique.

  Copyright (c) 2001-2002, Ghislain Picard, Marin Dacos
  Copyright (c) 2003, Ghislain Picard, Marin Dacos, Luc Santeramo, Nicolas Nutten, Anne Gentil-Beccot

  Home page: http://www.lodel.org

  E-Mail: lodel@lodel.org

                            All Rights Reserved

     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
     (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU General Public License for more details.

     You should have received a copy of the GNU General Public License
     along with this program; if not, write to the Free Software
     Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-->

<!-- ce fichier n'est pas un template -->

<p align="center">Configuration de la base de donnée.</p>


<?php if ($installoption==1) { // OPTION 1 ?>
<p>[option 1]</p>
<p align="justify">
Choisir une base de données ou en créer une nouvelle. En général, la base de donnée est créée par l'herbergeur et il n'est pas possible d'en ajouter une nouvelle. Se reporter au support technique de l'hebergeur.<p>
<p align="justify">
Le prefix de table est utile lorsqu'une seule base de donnée est disponible (comme c'est souvent le cas chez les hébergeurs) et que d'autres applications partageront la base de donnée avec Lodel. En cas de doute, utiliser "lodel_" comme prefix.
</p>
<p align="justify">
Une installation Lodel peut gérer plusieurs sites, dans ce cas, il faut choisir:
<ul>
<li>Une unique base de donnée pour tous les sites.
<li>Une base de donnée par site, en plus de la base principale.
</ul>
</p>
<?php } else { // OPTION 2 ?>
<p>[option 2]</p>
<p align="justify">
Il est possible d'utiliser une base de donnée existante. Cependant, il est préférable de créer un base de donnée dédiée à Lodel <?php if (!$createdatabase) { echo "par exemple lodeldb"; }?>:
</p>
<p>
<code>
CREATE database <?php if ($createdatabase) { echo "$createdatabase"; } else { echo "lodeldb";} ?>;
</code>
</p>
<p>
Dans tous les cas, il faut donner les droits "ALL" sur la base à l'utilisateur "<?php echo $dbusername; ?>":
<p>
<p>
<code>
GRANT ALL ON <?php if ($createdatabase) { echo "$createdatabase"; } else { echo "lodeldb";} ?>.* TO <?php echo "$dbusername@$dbhost";?>;
</code>
</p>
<p align="justify">
Le prefix de table est utile lorsqu'une seule base de donnée n'est disponible et que d'autres applications partageront la base de donnée avec Lodel. Cette situation n'est recommandée car elle rend difficile les migrations et les restaurations.
</p>
<p align="justify">
Une installation Lodel peut gérer plusieurs sites, dans ce cas, il faut choisir:
<ul>
<li>Une unique base de donnée pour tous les sites. Cette option simplifie la creation de nouveaux sites, mais interdit rend plus délicat la restauration en cas de probleme ou le multi-versioning (coexistence de plusieurs sites utilisant différentes version de Lodel). Autrement dit, cette option impose la restauration et la migration de tous les sites simultannements.
<li>Une base de donnée par site, en plus de la base principale. Cette solution est recommandée, mais une base de donnée devra être créée pour chaque site!
</ul>
</p>
<?php } // fin OPTION 2 ?>


<?php  if ($erreur_createdatabase) { ?> <b>Erreur</b>: Impossible de créer ou d'accéder à la base de données "<?php echo $database; ?>". L'erreur produite est: <?php  echo mysql_error(); ?> <?php } ?>

<?php  if ($erreur_usedatabase) { ?> <b>Erreur</b>: L'utilisation de cette base de données ne semble pas possible. L'utilisateur MySQL a-t-il les droits ? L'erreur produite est: <?php  echo mysql_error(); ?> <?php } ?>

<?php  if ($erreur_createtables) { ?> <b>Erreur</b>: La création des tables a échoué. La commande SQL et l'erreur produite sont: <?php echo $erreur_createtables; ?> <?php } ?>


<form method="post" action="install.php">
<input type="hidden" name="tache" value="database">
<table border="1">

<tr><td>
Base de données:<br>
			<table>
			  <?php  if (!$result) $result=@mysql_query("SHOW DATABASES");
			     while ($row=mysql_fetch_row($result)) {
			     $dbname=$row[0];
			     if ($database==$dbname) {
			         $checked="checked"; $oneischecked=1;
			     } else {
			         $checked="";
			     }
			  ?>
			  <tr><td><input type="radio" name="newdatabase" value="<?php echo $dbname; ?>" <?php echo $checked; ?>></td><td><?php echo $dbname; ?></td></tr>
		          <?php  } ?>
			  <tr><td><input type="radio" name="newdatabase" value="" <?php  if (!$oneischecked) echo "checked"; ?> ></td><td>Créer une nouvelle base de donnée: <input type="text" size="20" name="createdatabase" value="<?php echo $createdatabase; ?>"></td></tr>
			</table>
</td></tr>
<tr><td>
Base de donnée unique pour tous les sites:<br>
<input type="checkbox" name="newsingledatabase" <?php  if ($singledatabase) echo "checked"; ?>>
</td></tr>
<tr><td>
Préfix des tables:<br>
<input type="text" size="20" name="newtableprefix" value="<?php echo $tableprefix ? $tableprefix : ($installoption==1 ? "lodel_" : ""); ?>">
</td></tr>
</table>
<input type="submit" value="continuer">

</form>
<?php  include("tpl/install-closehtml.html"); ?>