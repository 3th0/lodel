*
* modif pour ajouter les styles recensions, erratum, ndlr, droitsauteur, surtitre: lodel/revue/lodel/edition/balises.php
Pour le moment, tous ces styles sont accessibles dans documents.php uniquement. Il faut me dire ce qu'il faut en faire exactement (surtout les recensions... a mettre dans la base ?).
Il faut aussi me dire lesquels on affiche (ou on affiche pas) quand le texte n'est pas publie ! c'est important de securiser dans le php, sauf si vous souhaitez que chaque revue decide... dans ce cas, toutes les revues assumes le choix d'afficher ou pas un erratum, un ndlr, etc quand le texte n'est pas publie.

* Mettre a jour en consequence la DTD de lodel.

* Modif de extrainfo.php pour gerer aussi le surtitre

* ajouter dans tpl/extrainfo.html le bloc suivant pour les surtitres
<TR>
	<TD>Sur Titre:</TD>
	<TD><INPUT SIZE="80" TYPE="text" NAME="surtitre" value="[#SURTITRE]"></TD>
</TR>



* Il faut qu'on discute longuement des affiliations. Ca pose un gros probleme, il va falloir changer la base. En effet on ne peut pas mettre les affiliations dans la table auteurs parce qu'un auteur peut avoir plusieurs affiliaitons, et on ne peut pas la mettre dans la table documents, parce qu'un document a plusieurs affiliation (car plusieurs auteurs). Une solution est de ne pas mettre l'affiliation dans la base... elle n'est alors accessible que du document ou elle a ete definie. Une autre solution est de la mettre dans  documents_auteurs.
A decider: d'ou veut-on acceder aux affiliations ?


* dans les index (mots.php, periodes.php,etc...), la boucle "alphabet" permet de parcourir l'alphabet, [#LETTRE] permet contient la lettre en majuscule. C'est plus propre d'utiliser ca que de coder en dur les listes de lettres. Parfois, c'est meme obliogatoire (comme dans l'ancienne maquette de CH).

* lodel/script/baseindex.php a ete changer pour le code de boucle_alphabet


* (important pour les developpeurs) j'ai change le systeme pour les boucles utilisateur (celle ecrite en php mais accessible en lodelscript) afin de supprimer le probleme qu'on a sur topparent. Maintenant, la fonction qui definie la boucle prend deux arguments (exemple dans lodel/revue/lodel/edition/index.php) :

function boucle_themesparents (&$context,$funcname) {

et l'appel a la fonction "code" se fait par:

call_user_func("code_boucle_$funcname",$localcontext);

au lieu de code_boucle_themes_parents.

De meme on a call_user_func("code_avant_$funcname",$localcontext); et call_user_func("code_apres_$funcname",$localcontext); (meme signification que dans les boucles SQL normales).

* lodel/revue/lodel/edition/index.php a ete modifie pour changer le code de boucle_themesparents.

* lodel/scripts/parser.php modifie pour le probleme des boucles si dessus et pour le repertoire share/macros


19/03/03

* (Anne) Les styles (.dot) title et subtitle sont converti automatiquement en francais lors de l'importation de fichier rtf (document ou sommaire). Ceci les rendu compatible avec lodel. Si on veut a l'avenir precise la langue sur le titre, il faudra distinguer title de titre.

* (Anne) Dans lodel_sommaire.dot, je prefere motcles au pluriel. Comme ca c'est compatible avec lodel.dot

* Suppression des balises recension_* dans la mesure ou elles ne servent a rien en ce moment et doivent etre longuement discutee.

* Il faut definir les styles pour les resumes et les motcles dans langues.php uniquement. La gestion de la langues pour les motcles n'est pas encore geree, mais ca va venir.


* Dans tpl/chkbalisages.html
les lignes pour abandonner et continue sont changees:
 <div align="center"><A HREF="abandon.php?id=[#ID]">&lt; Abandonner</A> | <A HREF="[#URLSUITE]">Continuer &gt;</A>


* Lors de l'importation des sommaires, je me sers de balises auteurs pour separer les differents articles (ou documents). Par consequent, preciser un auteur est obligatoire et est obligatoirement au debut. Si vous souhaitez un autre systeme, il est encore temps.

* actuellement l'importation d'image dans les documents d'une importation massive n'est pas geree. C'est en principe possible de le faire dans l'avenir.

* j'ai ajoute une fonction pour supprimer les sauts de ligne dans les formulaires qui font croire qu'on a qu'une partie du champ (en regardant le source on voit qu'il y a une deuxieme ligne). Il faut bien verifie que cette modif ne pose pas de probleme. Elle affecte tous les champs rentres dans des formulaires.

* il y avait un bug dans calcul-pages qui faisait que le tempate etait recompiler a chaque fois !!!!

20/03/03

* Il va s'en  dire qu'avec le systeme choisi, tout style supporte dans l'import de document, fonctionne dans l'import de sommaire (car on utilise extrainfo).

* Correction d'un bug qui empechait l'importation de certains fichiers (ceux qui se termine sur un article et non par un regroupement).

* Le systeme ne peut pas generer les regroupements vides en l'etat (car lodel regroupe les paragraphes de meme style quand ils sont contigues). Il faut donc mettre entre les deux un espace tage differement. Une solution est de mettre un mot cle, genre "vide". L'ensentiel n'est pas le mot, mais le style de ce paragraphe intermediaire. Une autre solution serait de supposer que deux paragraphes de regroupement signifie que c'est deux regroupements. Si vous avez une autre idee...

* le fichier rtf est stocke dans rtf/r2r-publi-xxx.rtf ou xxx est l'idee du numero. Le fichier xml n'est pas stocke, mais le fichier xml correspondant a chaque document est stocke.

* pour adapter l'affichage dans extrainfo.php et publication.php quand on est en importation de sommaire, vous disposez de la variable [#IMPORTSOMMAIRE]. Elle est vrai ou fausse, il suffit de la tester avec un IF. Un exemple d'utilisation est dans extrainfo.html
Pour que ca marche correctement, il faut ajouter la ligne <INPUT TYPE="hidden" NAME="importsommaire" VALUE="[#IMPORTSOMMAIRE]"> dans les formulaires d'extrainfo.php et de publication.php (je l'ai ajoute sur le CVS, normalement c'est bon)

* c'est evident, mais il faut adapter tpl/chargesommaire.html
Remarque: pour le moment, chargement.php et chargesommaire sont parfaitement identiques, donc on peut charger des sommaires via "ajouter document". (je sais ca sert a rien).


* (Luc) a propos de checkXML.pl
Je crois que le XML produit est maintenant en conformite, mais il faut le verifier avec checkXML.pl ci-joint. Il faut install les modules. Je te conseille vivement l'utilisation de perl -MCPAN -e shell (il faut installer avant ca le module CPAN.pm) qui est du meme genre que le surpuissant couple urpmf et urmpi (redhat/mandrake private joke). En gros ce systeme te permet d'installer et d'upgrader les modules perl automatiquement, avec les dependances, svp. Donc ca prend trente secondes d'installer les packages necessaires pour faire tourner checkXML.pl (aller 10min). Dans perl -MCPAN -e shell, tu tapes "install XML::Checker::Parser" puis pareil avec XML::Catalog (il y en a un autre aussi, mais tu trouveras facilement en lancant checkXML.pl).

Ensuite, tu vas chercher les dtd xhtml modularized (fichier xhtml-modularization.tgz sur w3c) et tu ajustes dans checkXML.pl le chemin du catalogue. Si tu veux pas utiliser le catalogue, mais directement charger la DTD via le net a chaque checkXML.pl, n'utilise pas les catalogues (c'est les catalogues qui plantent chez moi depuis que je suis en Mandrake 9.0). Voila checkXML.pl est pret a tourner... tu l'executes sur tous les fichiers xml.
J'ai quand meme un probleme, notre dtd, il faudrait la declarer avec une adresse public (la mettre sur www.lodel.org) et mettre la bonne ligne dans tous les fichiers xml. Pour le moment, c'est la ligne <!DOCTYPE article SYSTEM "r2r-xhtml-1.dtd"> avec chemin d'acces relatif (donc attention quand tu fais le checkXML.pl, la DTD lodel doit etre dans le meme repertoire). Si tu peux fixer ce pb, tu seras le roi.
On avait pas dit qu'on mettait la DTD dans l'arboressence du CVS ?

27/03/03

Reflexion a propos des liens entre documents.
Depuis quelques temps, on s'apercoit qu'il faut gerer des fonctionalites diverses:
* traduction de document.
* recension.
* references entre documents

Je propose de gerer de facon identique (=au moyen d'une seule solution informatique) ces trois fonctionalites, et si necessaire dans l'avenir de nouvelles fonctionnalites compatibles avec la solution informatique. Ce texte ne contient que des propositions, il s'agit pour les developpeurs (et autres) de discuter le vocabulaire (on a vu de nombreux va et vient source de conflit et de perte de temps), les regles d'utilisation au niveau informatique (fixer les limites pour ne pas travestir le systeme), l'implementation, et un peu de l'utilisation au niveau lodel, c'est a dire comment les info sont entrees par l'utilisateur, quel styles seront defini, etc...

Mon idee est de tenir une table des liaisons ou liens (voca a preciser) entre les documents ainsi que le type de la laison.
Donc ca serait:
le document id1 est la traduction du document id2
id1 est une recension du documents id2
id1 fait references au document id2 ou id1 est reference par id2.

Rmq: dans l'exemple 3 les liaisons ne sont pas orientes. Par contre, dans l'exemple 2 la liasion est clairement orientes. Pour l'exemple 1, c'est moins clair. Du point de vue de l'edition, il y a la langue du document original et ensuite les traductions. En edition electronique c'est moins clair. Bref, il faut des laisons orientees.

L'implementation en terme de DB est simplement une table a trois champs: id1, id2, type_liaison (code sur un caractere a priori, T, R, L).
Les modifications a apporte a Lodel sont extrement limites ce qui signifie que malgre la puissance et la complexite apparente du systeme, l'implementation demander tres peu de travaille. On va surement passer plus de temps a discuter qu'a programmer.

*********** Application au traduction:

Rmq: ceci ne concerne ni les documents multilingues, ni un resume en un autre langue dans un document. Il s'agit ici de traduction (plus ou moins, mais plutot plus) integrale. Ce sera au choix de l'utilisateur d'estimer si un abstract fait partie du document francais, ou s'il c'est une traduction, donc un doc independant, du document francais.

Contrairement a la situation actuelle (qui ne permet pas les documents traduits), une traduction est un document independant du document orginal donc avec un id propre. L'import pourrait se faire soit de maniere independante (un fichier rtf par langue) soit par un unique fichier contenant les differentes balises en differentes langues (je ne suis pas pour ce systeme, meme si dernierement j'ai propose title dans l'import de sommaire, ou la il est clair qu'on ne peut pas avoir plusieurs fichiers rtf). Ensuite, l'utilisateur preciserait la liaison entre les deux documents, par exemple en cliquant "ajouter une liaison" ou en  editant les meta donnees du documents et en precisement l'autre document (pas via l'id comme actuellement pour les liens, mais via une arbo des documents geree par javascript).

Pb: comment afficher proprement le sommaire d'un numero contenant des traductions.
Comme les documents (traduits) sont rataches au meme numero, ils vont apparaitrent dans le sommaire. Solution:
* On peut tester la langue, c'est a dire que seul les documents lang=="fr" apparaissent dans le sommaire fr => probleme pour les revues qui ont des documents dans plusieurs langues, mais qui ne sont pas des traductions (cad il n'y a qu'un sommaire qui contient des documents dans differentes langues).
* On peut tester: la langue du document lang="fr" OU s'il n'a pas ete traduit. => probleme si un document en anglais a ete traduit en allemand uniquement, il n'apparaitra pas dans le sommaire en francais.
Bref ce dernier cas est un casse-tete car qu'est ce qu'on decide d'afficher dans le sommaire en francais, la version anglaise ou allemande ?

Rmq: comme l'affichage se gere au niveau des revues, il est possible d'avoir une gestion adaptee a chaque revue. Par exemple, au moyen d'une requete SQL pas tres simple, de preciser que si le documents existe en anglais, alors il s'affiche dans le sommaire en francais sauf si c'est une traduction du francais en anglais.

************* Application aux recensions:

D'apres ma comprehension naive de ce qu'est une recension, je gererais les choses comme ca:

L'article rencense est un document independant de la recension.
S'il l'article recense est publie dans la revue (attention, la table liaison proposee ici ne peut pas faire d'inter-revue, mais on peut en discuter), c'est parfait, il a le meme status que les autres documents, on informe juste lodel de la liaison.

S'il l'article recense n'est pas publie dans la revue (et disons meme dans aucun revue gerer par Lodel) il doit etre entre quand meme comme un document independant, c'est a dire au moins son titre, et les auteurs. Il n'est pas exclu d'utiliser des styles recense_titre recense_auteurs (c'est a dire un unique fichier rtf), mais Lodel produirait autant de document que de documents recenses + la recension.
Les documents recenses aurait le type recension et pourrait soit appartenir au numero dans lequel il est recense (mais c'est pas logique si un meme article est recenses dans plusieurs numeros), soit n'appartenir a aucun numero (mais ca peut poser des problemes pour acceder a ce numero dans l'interafce edition), soit dans une publication de type "recensions" (avec un s). Dans ce dernier cas, on peut meme imaginer une structure lineaire ou hierachique et des series_recesnions pour bien organiser les articles recenses. Ceci permettrait de faire facilement des sommaires (ou listes) des articles recenses. Bref, il faut les mettre quelque part (amha c'est surtout une question d'accessibilite dans la zone d'edition plutot qu'un probleme d'affichage sur le site).

Cette facon de gerer les recensions permet:
* de la puissance, c'est a dire que toutes les infos que l'on a dans notre base sur les documents serait aussi disponible pour les recensions, a savoir lang, resume de l'article recense, etc... (souvent on trouve les resumes free des articles sur le net). 
* gestion simple de plusieurs articles recenses par recension.
* gestion simple quand plusieurs recension recensent le meme document (ce qui n'etait a priori pas gagner quand on avait reflechi au pb des recensions).
* gestion facile des auteurs car la table existe deja, le xml existe deja, etc... Pb on ne peut pas distinguer facilement les auteurs normaux (ceux des documents) de ceux qui on fait l'objet d'une recension. En effet dans la table auteurs, il n'y a pas d'information sur la nature des articles qu'ils ont ecris. Donc dans l'index par auteur, il sera difficile (a moins d'une requete SQL assez compliquee a ecrire) de n'afficher que les auteurs qui ont ecris un article normal (en excluant ceux qui ont ecris un article recense mais non publie dans Lodel). Je ne sais pas si c'est genant. De toute facon, on peut toujours ecrire cette affreuse requete SQL.
* L'affichage des sommaires serait facile a faire, avec ou non la liste des articles recenses sous chaque recension.

Idee: l'article recense peut etre sur internet et en particulier dans une autre revue. Il est souhaitable, amha, d'avoir l'url du document recense (par exemple, pour illustrer, en ajoutant un champ url dans la table document, et un style word url). Il n'y a pas de difficulte ici, mais on marquerait ici un profond changement de la philo de Lodel. En effet, si on a un champ url, Lodel permet de faire un annuaire de lien (biblinks). D'ailleurs qu'est ce qu'un annuaire de lien sinon des recensions de site ?
Dans ce cas, pourquoi ne pas fusionner (au niveau informatique) Lodel (philo, edition electronique de revue) avec Biblinks (philo recension de lien).

* le long travail sur les champs bibliographiques dans Biblinks serait utilise dans Lodel (on ajouterait plus ou moins directement tous les champs biblinks dans la table documents de Lodel).
* L'interface edition et la zone inetrnaute de Biblinks serait reecris en lodelscript, presque sans modification de code php. L'interface edition serait aussi completement "traduite" en biblinks, il serait possible d'importer des descriptions de sites en rtf (avec un stylisation en word) ou de les ecrire directement dans une form (comme c'est le cas actuellement dans biblinks). Tout amelioration faite sur Lodel (par exemple des macros) serait ainsi disponible dans biblinks
* les categories biblinks seraient gerees par le systeme de publication de Lodel (type: serie_hierarchique, themes). Le systeme de lien symbolique entre categorie utilises dans biblinks serait transfere sur Lodel.
* Autres avantages: les sites Biblinks auraient un fichier en XML, gestion de l'unicode quand lodel le fera, possibilite d'avoir une image (jpeg) du site.
* Me preciser les fonctionnalites de Biblinks que j'ai totalement oubliees et qui poserait a priori un pb de transfert.

Encore une fois, tout ceci semble complexe, mais induit peu de developpement informatique php car Lodel a deja presque les fonctionnalites de Biblinks (mais avec un vocabulaire different). Le plus gros travail a faire est du lodescript (ceci etait de toute facon prevu).


******** Application aux liens.

Le systeme de referencement des documents entre eux demande par Espace Temps (?) peut aussi etre gerer par le systeme propose. Dans ce cas, il suffit d'etablir le lien entre les deux documents de facon similaire a la liaison traduction. Il a peu a dire, sinon que le systeme de documents annexe permet deja actuellement de faire ce lien, en donnant en plus la possibilite d'ajouter un commentaire qui decrit la nature du lien. C'est donc la difference principale. 
Il faut voir le systeme de lien dans le document annexes comme une reference souple indiquant "il y a peut etre des informations dans ce documents" et le lien liaison comme une reference dure "ces documents sont intimements lies pour une raion X ou Y". 

Se pose la question de savoir si dans cette table des liaisons on ajoute un champ commentaire. Ceci pourrait etre utile pour que docannexe et liaison remplissent a peu pres le meme role pour les documents internes. Pour la liaison "traduction", on pourrait dans le champ commentaire mettre le traducteur, et divers commentaire sur la traduction comme la date, etc. MAIS, il ne faudrait pas avoir une augmentation considerable des champs. Par exemple, les champs ordre et titre dans docannexe n'ont peut etre pas d'interet dans liaison (ceci dit, est-ce que les articles recenses doivent etre affiches dans un ordre particulier dans la recension ?).

En bref, sur cette question des liens, il faut qu'on reflechisse encore un peu si on remplace les docannexes par le systeme de liaison.



Ghislain

