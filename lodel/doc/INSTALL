

Installation d'une nouvelle revue:

1. Creer le repertoire et l'arborescence:

Exemple sur la revue: rev (nom abrege)

A la racine du site, creer le repertoire de la revue: mkdir rev
Dans le repertoire de la revue rev: cd rev
Lancer le script d'installation: ../install/install-revue.pl
Ce script ne doit pas produire d'erreur.
Ce script cree l'abrorescence, met les droits correctes sur les repertoires, et fait des liens symboliques sur les scripts php.
Il fait des liens symboliques sur les templates lodel/edition/tpl et lodel/admin/tpl, afin d'avoir une revue qui marche. Mais pour specialiser l'administration d'une revue, il est necessaire d'ecrire des templates adaptes. Dans ce cas, il faut detruire le lien symbolique (avec la commande rm) et mettre le nouveau template a la place.
Les templates de la revue (repertoire rev/tpl) ne sont ni copiés ni liés car ils sont specifiques à la revue (au moins les images). Il suffit donc de copier a la main ceux d'une autre revue, et de les adapter. Le fichier styles est lie symboliquement au fichier style general (celui qui est dans la racine du site), il est aussi peut etre necessaire de le detruire et de le remplacer.
D'une maniere generale, faire attention avec les liens symboliques: ne pas editer un lien symbolique, car ca edite le fichier principal (celui vers lequel le lien pointe), et donc change pour toutes les revues le fichier. Il faut donc effacer le lien symbolique puis creer un fichier.
Il est aussi necessaire de creer a la main le repertoire rev/images ou de le copier a partir d'une autre revue:
Dans le repertoire rev, faire: cp -R ../autrerev/images .

2. Creer la revue.

Avec le navigateur, aller dans admin/revues.php
Remplir le formulaire.
Ce script cree les tables dans la base de données.

Voila, c'est termine, la nouvelle revue est completement créée.

3. Importation des fichiers R2R1999.


Cette etape est un peu bricolo.
A partir de la racine du site, aller dans le repertoire r2r, et copier les fichiers txt original de la revue.

cd r2r
cp -R repertoiredesfichiers/txt .
ou faire un lien symbolique:
ln -s repertoiredesfichiers/txt .

Dans r2r, lancer le script wrapper. Ce script cree dans le repertoire tmptxt, les fichiers lisibles par lodel.
Verifier la xmlisation: dans le navigateur, aller dans rev/admin/r2rcheck.php
Ce script verifie que les fichiers txt sont bien xml. En cas d'erreur (et il y en aura, c'est quasi sur).
Corriger le fichier concerne dans le repertoire r2r/txt/x-xxxx
relancer le wrapper sur cette annee: wrapper x-xxxx
En general les erreurs viennent de balises enchevetrees (genre (!--toto--)<P>(!--)</P>).
Quand tout est passe dans r2rcheck.php, aller dans rev/admin/rmdb.php puis clicker sur enregistrer.
La encore, il se peut que des erreurs de xmlisation apparaissent. Dans ce cas, corriger le fichier dans txt/x-xxxx puis lancer le wrapper, et dans le navigateur relancer rmdb.php (l'etape r2rcheck est facultative).
Quand tout est passe dans r2renregistrer, la base est a jour... il y a quand meme un gros travail de verification a faire, la modif peut se faire avec l'interface, ou en modifiant les fichiers dans txt, puis wrapper, puis rmdb.php, enregistrer...
Quand tout est ok, archiver les fichiers txt et les copier en lieu sur.
Detruire les fichiers txt et tmptxt avant d'importer une autre revue.





