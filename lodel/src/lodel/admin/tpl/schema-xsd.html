<!--[

   LODEL - Logiciel d'Edition ELectronique.
   Copyright (c) 2001-2002, Ghislain Picard, Marin Dacos
   Copyright (c) 2003, Ghislain Picard, Marin Dacos, Luc Santeramo, Nicolas Nutten, Anne Gentil-Beccot
   Home page: http://www.lodel.org
   E-Mail: lodel@lodel.org
                             All Rights Reserved
      This program is free software; you can redistribute it and/or modify
      it under the terms of the GNU General Public License as published by
      the Free Software Foundation; either version 2 of the License, or
      (at your option) any later version.
      This program is distributed in the hope that it will be useful,
      but WITHOUT ANY WARRANTY; without even the implied warranty of
      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
      GNU General Public License for more details.
      You should have received a copy of the GNU General Public License
      along with this program; if not, write to the Free Software
      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.]-->

<--[ Warning: the loop name must be different for the ones in lodel/edition/xml-classe.html because the two templates can be imported in the same script ]-->

<xsd:schema targetNamespace="http://www.lodel.org"
                xmlns="http://www.lodel.org"
                xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                xmlns:xhtml="http://www.w3.org/1999/xhtml"
                elementFormDefault="qualified">

<xsd:import namespace="http://www.w3.org/1999/xhtml"
                schemaLocation="http://www.w3.org/2002/08/xhtml/xhtml1-strict.xsd"/>

<!--[ structure generale du document ]-->
    <xsd:element name="document" type="articleType"/>
	<xsd:complexType name="articleType">
            <xsd:sequence>
	<!--[ les groupes de personnes ]-->
    	<LOOP NAME="typepersonnes_xsd" TABLE="typepersonnes" WHERE="statut gt 0" ORDER="ordre">
		<DO>
            <xsd:element name="gr[(#TYPE|removespace)]" minOccurs="0" maxOccurs="1">
		      <xsd:complexType>
		        <xsd:sequence>
		          <xsd:element name="[(#TYPE|removespace)]" type="typePersonne" minOccurs="1" maxOccurs="unbounded" />
		        </xsd:sequence>
		      </xsd:complexType>
		    </xsd:element>
		</DO>
   	</LOOP>
	<!--[ les groupes d'entrees ]-->
    	<LOOP NAME="typeentrees_xsd" TABLE="typeentrees" WHERE="statut gt 0" ORDER="ordre">
	      	<DO>
                <xsd:element name="gr[(#TYPE|removespace)]" minOccurs="0" maxOccurs="1">
		     <xsd:complexType>
		       <xsd:sequence>
		           <xsd:element name="[(#TYPE|removespace)]" type="typeEntree" minOccurs="1" maxOccurs="unbounded" />
		       </xsd:sequence>
		     </xsd:complexType>
		</xsd:element>

		</DO>
	</LOOP>
	<!--[ les groupes de champs ]-->
	    <LOOP NAME="groupesdechamps_xsd" TABLE="groupesdechamps" WHERE="classe='[#CLASSE]'" ORDER="ordre">
      	<DO>
	        [<xsd:annotation>
				<xsd:documentation xml:lang="fr">
					(#COMMENTAIRE)
				</xsd:documentation>
			</xsd:annotation>]
			<xsd:element name="[#NOM]">
			 <xsd:complexType>
		            <xsd:sequence>

		<LOOP NAME="champs_xsd" TABLE="champs" WHERE="idgroupe='[#ID]'" ORDER="ordre">
	    		<DO>
			<!--[ define the minOccurs and maxOccurs and put it in [#OCCURS] variable ]-->
			<IF COND="[#CONDITION]=='+'">
			  <LET VAR="occurs">minOccurs="1" maxOccurs="unbounded"</LET>
			<ELSE/>
			  <LET VAR="occurs">minOccurs="0" maxOccurs="unbounded"</LET>
			</IF>
				<IF COND="[#TYPE] eq 'boolean'">
				<LET VAR="xsdtype">xsd:boolean</LET>
				<ELSE/>
				<IF COND="[#TYPE] eq 'mltext'">
				<LET VAR="xsdtype">TexteMultiLangue</LET>
				<ELSE/>
  	        		<IF COND="[#TYPE] eq 'lang'">
				<LET VAR="xsdtype">xsd:language</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'date'">
				<LET VAR="xsdtype">xsd:date</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'datetime'">
				<LET VAR="xsdtype">xsd:dateTime</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'time'">
				<LET VAR="xsdtype">xsd:time</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'int'">
				<LET VAR="xsdtype">xsd:int</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'numeric'">
				<LET VAR="xsdtype">xsd:double</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'image'">
				<LET VAR="xsdtype">xsd:anyURI</LET>
				<ELSE/>
		 		<IF COND="[#TYPE] eq 'fichier'">
				<LET VAR="xsdtype">xsd:anyURI</LET>
				<ELSE/>
				<LET VAR="xsdtype">LodelTexte</LET>
				</IF>
				</IF>
				</IF>
				</IF>	
				</IF>
				</IF>
				</IF>
				</IF>
				</IF>	
				</IF>

		                 <IF COND="[#COMMENTAIRE]">
				<xsd:element name="[#NOM]" type="[#XSDTYPE]" [#OCCURS]>
                                <xsd:annotation>
					<xsd:documentation xml:lang="fr">
						[#COMMENTAIRE]
					</xsd:documentation>
				</xsd:annotation>
				</xsd:element>
				<ELSE/>
				<xsd:element name="[#NOM]" type="[#XSDTYPE]" [#OCCURS] />
			      </IF>

	    </DO>
	  </LOOP>
		            </xsd:sequence>
			 </xsd:complexType>
	        </xsd:element>
      </DO>
    </LOOP>




		<xsd:element name="meta">
			<xsd:complexType>
			<xsd:sequence>
				<xsd:element name="typedoc">
					<xsd:simpleType>
						<xsd:restriction base="xsd:string">
						<LOOP NAME="typedoc_xsd" TABLE="types" WHERE="classe='documents' AND statut gt 0">
							<xsd:enumeration value="[#TYPE]"/>
						</LOOP>
						</xsd:restriction>
					</xsd:simpleType>
				</xsd:element>
			</xsd:sequence>
			</xsd:complexType>
	    	</xsd:element>

            </xsd:sequence>
        </xsd:complexType>
    <!--[ element document ]-->


	<!--[ type GroupePersonne ]-->

    <xsd:complexType name="typePersonne">
            <xsd:sequence>
	        <xsd:element name="prefix" type="xsd:string" minOccurs="0" maxOccurs="1"/>
		<xsd:element name="prenom" type="xsd:string"/>
		<xsd:element name="nomfamille" type="xsd:string"/>
	        <xsd:element name="description" type="xsd:string" minOccurs="0" maxOccurs="1"/>
		<xsd:element name="fonction" type="xsd:string" minOccurs="0" maxOccurs="1"/>
	        <xsd:element name="affiliation" type="xsd:string" minOccurs="0" maxOccurs="1"/>
	        <xsd:element name="courriel" type="xsd:string" minOccurs="0" maxOccurs="1"/>
            </xsd:sequence>
	    <xsd:attribute name="ordre" type="xsd:integer" use="required"/>
    </xsd:complexType>

    <xsd:complexType name="typeEntree">
            <xsd:sequence>
		<xsd:element name="nom" type="xsd:string"/>
		<xsd:element name="abrev" type="xsd:string"/>
            </xsd:sequence>
    </xsd:complexType>




<!--[ type TexteMultiLangue ]-->
	<xsd:complexType name="TexteMultiLangue">
		<xsd:sequence>
			<xsd:element name="ml" minOccurs="1" maxOccurs="unbounded">
				<xsd:complexType>
					<xsd:complexContent>
						<xsd:extension base="LodelTexte">
							<xsd:attribute name="lang" type="xsd:language" use="required"/>
						</xsd:extension>
					</xsd:complexContent>
				</xsd:complexType>
			</xsd:element>
		</xsd:sequence>
	</xsd:complexType>


<!--[ type LodelTexte ]-->
	<xsd:complexType name="Section" mixed="true">
		<xsd:group minOccurs="0" maxOccurs="unbounded" ref="xhtml:block" />
	</xsd:complexType>

	<xsd:complexType name="LodelTexte" mixed="true">
		<xsd:choice minOccurs="0" maxOccurs="unbounded">				    
			<xsd:element name="section1" type="Section"  />
			<xsd:element name="section2" type="Section"  />
			<xsd:element name="section3" type="Section"  />
			<xsd:element name="section4" type="Section"  />
			<xsd:element name="section5" type="Section"  />
			<xsd:element name="section6" type="Section"  />
			<xsd:element name="section7" type="Section"  />
			<xsd:element name="section8" type="Section"  />
			<xsd:element name="section9" type="Section"  />
			<xsd:element name="section10" type="Section"  />
			<xsd:group ref="xhtml:block"/>
			<xsd:group ref="xhtml:phrase"/> <!--[ c'est un peu trop laxiste la suite la ]-->
			<xsd:group ref="xhtml:fontstyle"/>
		</xsd:choice>
	</xsd:complexType>



</xsd:schema>