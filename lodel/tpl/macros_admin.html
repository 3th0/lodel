<!--[

   LODEL - Logiciel d'Edition ELectronique.
   Copyright (c) 2001-2002, Ghislain Picard, Marin Dacos
   Copyright (c) 2003, Ghislain Picard, Marin Dacos, Luc Santeramo, Nicolas Nutten, Anne Gentil-Beccot
   Copyright (c) 2004, Ghislain Picard, Marin Dacos, Luc Santeramo, Anne Gentil-Beccot, Bruno Cï¿½ou
   Copyright (c) 2005, Ghislain Picard, Marin Dacos, Luc Santeramo, Gautier Poupeau, Jean Lamy
   Home page: http://www.lodel.org
   E-Mail: lodel@lodel.org
                             All Rights Reserved
      This program is free software; you can redistribute it and/or modify
      it under the terms of the GNU General Public License as published by
      the Free Software Foundation; either version 2 of the License, or
      (at your option) any later version.
      This program is distributed in the hope that it will be useful,
      but WITHOUT ANY WARRANTY; without even the implied warranty of
      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
      GNU General Public License for more details.
      You should have received a copy of the GNU General Public License
      along with this program; if not, write to the Free Software
      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.]-->


<!--[ New macros added by Ghislain 12/2004 ]-->


<!--[ --------------------------------------------------------- 
      TR with alternating class             
--------------------------------------------------------------- ]-->

<DEFMACRO NAME="TR_LIST">
<IF COND="[#COUNT] % 2">
<tr class="ligne_admin1">
<ELSE/>
<tr class="ligne_admin2">
</IF>
</DEFMACRO>


<!--[ --------------------------------------------------------- 
      Ok button to come back to index.php
--------------------------------------------------------------- ]-->

<DEFMACRO NAME="OK_TOINDEX">
	<fieldset class="formButtons">
		<input type="button" class="button" value="    OK    " onclick="javascript:window.location='[#SITEROOT]lodel/edition/'" />
	</fieldset>
</DEFMACRO>

<!--[ --------------------------------------------------------- 
      Ok button to come back
--------------------------------------------------------------- ]-->

<DEFMACRO NAME="OK_BACK">
	<fieldset class="formButtons">
		<input type="button" class="button" value="    OK    " onclick="javascript:window.location='[#SITEROOT]lodel/edition/index.php?do=back'">
	</fieldset>
</DEFMACRO>


<!--[ --------------------------------------------------------- 
      Submit / Cancel / Delete bar.
--------------------------------------------------------------- ]-->

<DEFMACRO NAME="EDIT_SUBMIT_BAR">
<fieldset>
<legend>[@COMMON.VALIDATION]</legend>
	<MACRO NAME="SUBMIT_CANCEL_BUTTON">
	  <IF COND="[#ID]">
		<IF COND="![#LO|isdeletelocked([#ID],[#STATUS])]">
			<MACRO NAME="DELETE_BUTTON">
		</IF>
	  </IF>
</fieldset>
</DEFMACRO>


<!--[ --------------------------------------------------------- 
      Ok bouton to submit andgo from edit to list action
--------------------------------------------------------------- ]-->
<DEFMACRO NAME="SUBMIT_CANCEL_BUTTON">
		<IF COND="[#ID]"><input class="button" type="submit" value="[@COMMON.MODIFY]" /><ELSE/><input class="button" type="submit" value="[@COMMON.ADD]" /></IF>
		&nbsp;&nbsp;&nbsp;&nbsp;
		<input class="button" type="button" value="[@COMMON.CANCEL]" onclick="javascript:window.history.go(-1)" />&nbsp;&nbsp;&nbsp;&nbsp;
</DEFMACRO>

<DEFMACRO NAME="DELETE_BUTTON">
		<input class="button" type="button" value="[@COMMON.DELETE]" onclick="javascript:window.location='index.php?do=delete&lo=[#LO]&id=[#ID]'" />
</DEFMACRO>



<!--[ -----------------------------------------------------------
      Arrow up/down to change order
--------------------------------------------------------------- ]-->

<DEFFUNC NAME="CHANGE_RANK_BUTTON" REQUIRED="LO">
<IF COND="([#LODELUSER.RIGHTS] ge [#LO|rights('protect')]) or ([#LODELUSER.RIGHTS] ge [#LO|rights('write')] and [#STATUS] lt 32)">
	<a href="index.php?do=changerank&id=[#ID]&lo=[#LO]&dir=down"><img src="[#SHAREURL]/images/fleche_bas.png" class="picto" width="11" height="8" alt="bas" onmouseover="src='[#SHAREURL]/images/fleche_bas_survol.png'" onmouseout="src='[#SHAREURL]/images/fleche_bas.png'" /></a>
	<a href="index.php?do=changerank&id=[#ID]&lo=[#LO]&dir=up"><img src="[#SHAREURL]/images/fleche_haut.png" class="picto" width="11" height="8" alt="haut" onmouseover="src='[#SHAREURL]/images/fleche_haut_survol.png'" onmouseout="src='[#SHAREURL]/images/fleche_haut.png'" /></a>
<ELSE />
	<img src="[#SHAREURL]/images/fleche_bas_gris.png" width="11" height="8" class="picto" alt="Inactif" />
	<img src="[#SHAREURL]/images/fleche_haut_gris.png" width="11" height="8" class="picto" alt="Inactif" />

</IF>
</DEFFUNC>



<!--[ -----------------------------------------------------------
      Modify and delete button
--------------------------------------------------------------- ]-->

<DEFFUNC NAME="MODIFY_DELETE_BUTTON" REQUIRED="LO" OPTIONTAL="[#TITLE]">

<IF COND="([#LODELUSER.RIGHTS] ge [#LO|rights('protect')]) or ([#LODELUSER.RIGHTS] ge [#LO|rights('write')] and [#STATUS] lt 32)">
         <span class="sep">|&nbsp;</span><a href="index.php?do=view&amp;id=[#ID]&amp;lo=[#LO]">[@COMMON.MODIFY]</a><span class="sep">&nbsp;|&nbsp;</span>
	<IF COND="[#STATUS] ge 32">
	  <span class="inactif">[@COMMON.DELETE] ([@COMMON.PROTECTED])</span><span class="sep">&nbsp;|&nbsp;</span>
       <ELSE/>
	  <IF COND="[#LO|isdeletelocked([#ID],[#STATUS])]">
	  <span class="inactif">[@COMMON.DELETE] ([#LO|isdeletelocked([#ID],[#STATUS])])</span><span class="sep">&nbsp;|&nbsp;</span>
	  <ELSE/>
	  <a href="index.php?do=delete&amp;id=[#ID]&amp;lo=[#LO]" onclick="return confirm('[@COMMON.CONFIRM_DELETE|sprintf([#TITLE])]');">[@COMMON.DELETE]</a><span class="sep">&nbsp;|&nbsp;</span>
	  </IF>
	</IF>
	 <a href="index.php?do=copy&amp;id=[#ID]&amp;lo=[#LO]">[@COMMON.COPY]</a>
<ELSE/>
	 |<span class="sep">&nbsp;|&nbsp;</span><span class="inactif">[@COMMON.MODIFY]</span><span class="sep">&nbsp;|&nbsp;</span>
	  <span class="inactif">[@COMMON.DELETE]</span><span class="sep">&nbsp;|&nbsp;</span><span class="inactif">[@COMMON.COPY]</span><span class="sep">&nbsp;|</span>
</IF>
	
</DEFFUNC>



<!--[ -----------------------------------------------------------
      Print error message given the error code
--------------------------------------------------------------- ]-->

<DEFFUNC NAME="PRINT_ERROR_MESSAGE">
	<IF COND="[#ERROR] eq '+'">[@COMMON.ERROR_REQUIRED_FIELD]</IF>
	<IF COND="[#ERROR] eq '1'">[@COMMON.ERROR_FIELD_MUST_BE_UNIQUE]</IF>
	<IF COND="[#ERROR] eq 'date'">[@COMMON.ERROR_INVALID_DATE]</IF>
	<IF COND="[#ERROR] eq 'time'">[@COMMON.ERROR_INVALID_TIME]</IF>
	<IF COND="[#ERROR] eq 'datetime'">[@COMMON.ERROR_INVALID_DATETIME]</IF>
	<IF COND="[#ERROR] eq 'int'">[@COMMON.ERROR_INVALID_INTEGER]</IF>
	<IF COND="[#ERROR] eq 'number'">[@COMMON.ERROR_INVALID_NUMBER]</IF>
	<IF COND="[#ERROR] eq 'class'">[@COMMON.ERROR_INVALID_CLASS]</IF>
	<IF COND="[#ERROR] eq 'type'">[@COMMON.ERROR_INVALID_TYPE]</IF>
	<IF COND="[#ERROR] eq 'username'">[@COMMON.ERROR_INVALID_USERNAME]</IF>
	<IF COND="[#ERROR] eq 'passwd'">[@COMMON.ERROR_INVALID_PASSWD]</IF>
	<IF COND="[#ERROR] eq 'tablefield'">[@COMMON.ERROR_INVALID_FIELD]</IF>
	<IF COND="[#ERROR] eq 'style'">[@COMMON.ERROR_INVALID_STYLE]</IF>
	<IF COND="[#ERROR] eq 'mlstyle'">[@COMMON.ERROR_INVALID_MULTILINGUAL_STYLE]</IF>
	<IF COND="[#ERROR] eq 'url'">[@COMMON.ERROR_INVALID_URL]</IF>
	<IF COND="[#ERROR] eq 'email'">[@COMMON.ERROR_INVALID_EMAIL]</IF>
	<IF COND="[#ERROR] eq 'tplfile'">[@COMMON.ERROR_INVALID_TPLFILE]</IF>
	<IF COND="[#ERROR] eq 'textgroups'">[@COMMON.ERROR_INVALID_TEXTGROUPS]</IF>
	<IF COND="[#ERROR] eq 'readerror'">[@COMMON.ERROR_MISSING_FILE]</IF>
	<IF COND="[#ERROR] eq 'imageformat'">[@COMMON.ERROR_FORMAT_IMAGE]</IF>
	<IF COND="[#ERROR] eq 'reservedsql'">[@COMMON.ERROR_WORD_RESERVED_BY_SQL_OR_LODEL]</IF>
</DEFFUNC>


<!--[ -----------------------------------------------------------
      JS to follow an url with a select
--------------------------------------------------------------- ]-->
<DEFMACRO NAME="JS_SELECT_URL">
	<script type="text/javascript"><!--
	
		function select_url(obj) {
			var index = obj.selectedIndex;
			if (obj.options[index].value) window.location=obj.options[index].value;
		}
	//
	--></script>
</DEFMACRO>




<!--[ -----------------------------------------------------------
      Widget pour l'edition des differents types de champs
--------------------------------------------------------------- ]-->

<DEFFUNC NAME="PRINT_EDIT_FIELD" REQUIRED="varname,value,type" OPTIONAL="edition,eventattr,confirm">
<!--[ --------------- CONFIRM--------------------------- ]-->
<IF COND="[#CONFIRM]">
<LET VAR="eventattr">[#EVENTATTR] onChange="[#CONFIRM]();"</LET>
</IF>
<!--[ --------------- DISPLAY ONLY------------ -------------- ]-->
<IF COND="[#EDITION] eq 'display'">
<span class="displayfield">
	<IF COND="[#TYPE] ne 'passwd'">[#VALUE]<ELSE/>*******</IF>
<span>
<ELSE/>
<!--[ --------------- TEXT, LONGTEXT, USERNAME, EMAIL, URL -------------- ]-->
<IF COND="[#TYPE] eq 'text' or [#TYPE] eq 'username' or [#TYPE] eq 'longtext' or [#TYPE] eq 'url' or [#TYPE] eq 'email'">

	<IF COND="[#TYPE] eq 'longtext' or [#EDITION] eq 'textarea10'">
		<textarea rows="10" cols="50" name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR]>[#VALUE]</textarea>
	<ELSE/>
	<IF COND="[#EDITION] eq 'textarea30'">
		<textarea rows="30" cols="50" name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR]>[#VALUE]</textarea>
	<ELSE/>
		<input size="50" type="text" name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR] value="[#VALUE]">
	</IF>
	</IF>

<ELSE/>
<!--[ --------------- PASSWD -------------- ]-->
<IF COND="[#TYPE] eq 'passwd'">
<input size="50" type="password" name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR] >
<ELSE/>
<!--[ --------------- BOOLEAN -------------- ]-->
<IF COND="[#TYPE] eq 'boolean'">
    <input type="checkbox" name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR] [#VALUE|yes]>
<ELSE/>
<!--[ --------------- MLTEXT -------------- ]-->
<IF COND="[#TYPE] eq 'mltext'">
  <LOOP NAME="mltext"> <!--[ champ multilingue ]-->
    <div><label  style="display: block; margin: 10px 0 5px 0">[(#LANG|humanlang|ucfirst)] :</label> 
	<FUNC NAME="PRINT_EDIT_FIELD" TYPE="text" EDITION="[#EDITION]" VARNAME="[#VARNAME][[#LANG]]" VALUE="[#VALUE]" />
    </div>
  </LOOP>
  <div>
    <select name="addlanginmltext[[#VARNAME]]"><?php makeSelect($context,"","","lang"); ?></select>
    <input class="form" type="submit" name="reload2" value="[@COMMON.ADD]">
  </div>
	
<ELSE/>
<!--[ --------------- LANG,SELECT ------------- ]-->
<IF COND="[#TYPE] eq 'lang' or [#TYPE] eq 'select'">
	      <select name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR]>
		<?php  makeSelect($context,"value","",$context['type']); ?>
	    </select>
<ELSE/>
<!--[ --------------- MULTIPLESELECT ------------- ]-->
<IF COND="[#TYPE] eq 'multipleselect'">
	      <select name="[#VARNAME][]" id="[#VARNAME]" [#EVENTATTR] multiple>
		<?php  makeSelect($context,"value","",$context['type']); ?>
	    </select>
<ELSE/>
<!--[ --------------- DATE DATETIME TIME ------------- ]-->	    
<IF COND="[#TYPE] eq 'date' or [#TYPE] eq 'datetime' or [#TYPE] eq 'time'">
	<input size="30" type="text" name="[#VARNAME]" id="[#VARNAME]" [#EVENTATTR] value="[(#VALUE|humandate)]">

<ELSE/>
<!--[ --------------- IMAGE ------------- ]-->	    
<IF COND="[#TYPE] eq 'image'">
		
                   <table><tr>
		<IF COND="[#VALUE]"><img src="[(#VALUE|vignette(100))]" border="1"></IF>
                
	        <IF COND="[#VALUE]">
			<input type="radio" name="[#VARNAME][radio]" value="">Conserver l'image courante<br />
			<input type="radio" name="[#VARNAME][radio]" value="delete">[@COMMON.DELETE] <br />
		</IF>
		<input type="radio" id="[#VARNAME][radioserverfile]" name="[#VARNAME][radio]" value="serverfile">
	           <a href="javascript:;" onclick="window.open('filebrowser.php?caller=[#VARNAME]','Upload','width=250,height=200,top=100,left=100');">Choisir un fichier sur le serveur</a>&nbsp;&nbsp;<span id="[#VARNAME][localfilename]">&nbsp;</span><input size="40" type="text" id="[#VARNAME][localfullfilename]"><br />
		<input type="radio" id="[#VARNAME][radioupload]" name="[#VARNAME][radio]" value="upload">Choisir un fichier sur votre disque: <input size="40" type="file" name="[#VARNAME][upload]" onChange="document.getElementById('[#VARNAME][radioupload]').click();">
		 
	        </tr></table>
	        <input  type="hidden" id="[#VARNAME][previousvalue]" VALUE="[#VALUE]">
<ELSE/>
<!--[ --------------- COLOR ------------- ]-->	    
<IF COND="[#TYPE] eq 'color'">
<script language="Javascript" src="[#SHAREURL]/js/colorpicker.js"></script>
<script language="Javascript">
<!--
	var cp_[#NAME] = new ColorPicker(); // DIV style
-->
</script>
<input type="text" name="[#NAME]" size="7" value="[#VALUE]">
<a href="#" onclick="cp_[#NAME].select(document.forms[0].[#NAME],'colorpicker_[#NAME]');return false;" name="colorpicker_[#NAME]" id="colorpicker_[#NAME]">[@ADMIN.CHOOSE_A_COLOR]</a>
<script language="JavaScript">
<!--
document.forms[0].[#NAME].style.backgroundColor='[#VALUE]';
cp_[#NAME].writeDiv();
-->
</script>
<ELSE/>
???? Don't know how to edit this field. Type: [#TYPE] !
</IF>
</IF>
</IF>
</IF>
</IF>
</IF>
</IF>
</IF>
</IF>
</IF>
<!--[ error managment ]-->
<LOOP NAME="fielderror" FIELD="[#VARNAME]">
<p class="error"> <FUNC NAME="PRINT_ERROR_MESSAGE" />  </p>
</LOOP>
</DEFFUNC>


<!--[ -----------------------------------------------------------
      Export and Import translations button
--------------------------------------------------------------- ]-->

<DEFMACRO NAME="EXPORTER_IMPORTER_TRANSLATION">
  &nbsp;|&nbsp;
  <IF COND="[#LODELUSER.EDITOR] and (([#STATUS] lt 32) or [#LODELUSER.ADMINLODEL])">
    <a href="index.php?do=export&lo=translations&lang=[#LANG]">[@ADMIN.EXPORT]</a>&nbsp;
    |&nbsp;<a href="index.php?do=import&lo=translations&lang=[#LANG]">[@ADMIN.IMPORT]</a>&nbsp;|&nbsp;
  <ELSE/>
  <span class="inactif">[@ADMIN.EXPORT]</span>&nbsp;
  |&nbsp;<span class="inactif">[@ADMIN.IMPORT]</span>&nbsp;|&nbsp;
  </IF>
</DEFMACRO>
